import{s as k,k as N,l as L,o as i,c as a,a as e,i as C,m as M,u as n,F as $,d as j,t as m,v as T,e as x,h as F,g as w,p as A,w as D,f as l,r as I,n as P}from"./app-MOnSz09z.js";import{_ as R}from"./utils-mT5RtY73.js";import{a as S}from"./InvoiceSendMailModal.vue_vue_type_style_index_0_scoped_b9107dd6_lang-CoR13ITW.js";import{u as U}from"./renters-BWrsbS6i.js";import{u as B}from"./rooms-BBmIhNCl.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as E}from"./InvoiceFormModal-Ceh5VDJt.js";import{_ as z,I as O}from"./InvoiceSendMailModal-CmaRKEuw.js";import"./hotel-logo-EkMEN4AC.js";const h={class:"bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col sm:flex-row gap-4"},q=["value"],G=["value"],H={__name:"InvoiceFilters",setup(s){const v=S(),c=U(),f=B(),{activeFilters:r,isAnyFilterActive:g}=k(v),{updateFilters:p}=v,{renters:u}=k(c),{rooms:y}=k(f);N(r,d=>{p(d)},{deep:!0});const b=()=>{p({renter:"",room:"",status:"",month_year:""})};return L(()=>{c.fetchRenters(),f.fetchRooms()}),(d,t)=>(i(),a("div",h,[e("div",null,[t[5]||(t[5]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Locataire :",-1)),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>n(r).renter=o),class:"filter-input"},[t[4]||(t[4]=e("option",{value:""},"Tous",-1)),(i(!0),a($,null,j(n(u),o=>(i(),a("option",{key:o.id,value:o.id},m(o.last_name.toUpperCase())+" "+m(o.first_name),9,q))),128))],512),[[M,n(r).renter]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Chambre :",-1)),C(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>n(r).room=o),class:"filter-input"},[t[6]||(t[6]=e("option",{value:""},"Toutes",-1)),(i(!0),a($,null,j(n(y),o=>(i(),a("option",{key:o.id,value:o.id},m(o.name),9,G))),128))],512),[[M,n(r).room]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Statut :",-1)),C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>n(r).status=o),class:"filter-input"},t[8]||(t[8]=[e("option",{value:""},"Tous",-1),e("option",{value:"pending"},"En attente",-1),e("option",{value:"issued"},"Envoyée",-1),e("option",{value:"paid"},"Payée",-1)]),512),[[M,n(r).status]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Mois & Année :",-1)),C(e("input",{type:"month","onUpdate:modelValue":t[3]||(t[3]=o=>n(r).month_year=o),class:"filter-input"},null,512),[[T,n(r).month_year]])]),n(g)?(i(),a("button",{key:0,onClick:b,class:"btn-secondary"}," Réinitialiser ")):x("",!0)]))}},J=V(H,[["__scopeId","data-v-99c7601a"]]),K={class:"mt-6"},Q={key:0,class:"flex justify-center my-6"},W={key:1,class:"flex justify-center my-6 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg"},X={class:"text-lg font-medium ml-2"},Y={key:2,class:"flex justify-center my-6 bg-gray-800 px-6 py-4 rounded-lg shadow-lg"},Z={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8"},_={__name:"InvoicesList",setup(s){const v=S(),{fetchInvoices:c}=v,{filteredInvoices:f,error:r,loading:g}=k(v);return L(()=>{c()}),(p,u)=>(i(),a("div",K,[F(n(J)),n(g).fetch?(i(),a("div",Q,u[0]||(u[0]=[e("div",{class:"animate-spin inline-block w-6 h-6 border-4 border-white border-t-transparent rounded-full"},null,-1),e("p",{class:"text-white text-lg font-medium ml-2"},"Chargement des factures...",-1)]))):n(r)?(i(),a("div",W,[u[1]||(u[1]=e("span",{class:"text-xl"},"❌",-1)),e("p",X,m(n(r)),1)])):n(f).length===0?(i(),a("div",Y,u[2]||(u[2]=[e("p",{class:"text-gray-300 text-lg"},"📭 Aucune facture trouvée.",-1)]))):(i(),a("div",Z,[(i(!0),a($,null,j(n(f),y=>(i(),w(n(St),{invoice:y,key:y.id},null,8,["invoice"]))),128))]))]))}},tt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},et={class:"bg-white p-6 rounded-lg shadow-lg w-[30rem] animate-fade-in transform transition-transform scale-95"},st={class:"text-gray-700 mt-3"},ot={class:"text-gray-900"},nt={__name:"InvoiceDeleteModal",props:{invoice:Object},emits:["close"],setup(s,{emit:v}){const c=s,f=v,r=S(),{deleteInvoice:g}=r,p=A();function u(){f("close")}async function y(){try{await g(c.invoice.id),p.success("Facture supprimée avec succès."),u()}catch{p.error("Une erreur est survenue lors de la suppression.")}}return(b,d)=>s.invoice?(i(),a("div",tt,[e("div",{onClick:D(u,["self"]),class:"absolute inset-0"}),e("div",et,[d[3]||(d[3]=e("div",{class:"flex items-center space-x-3"},[e("span",{class:"text-red-600 text-2xl"},"⚠️"),e("h2",{class:"text-lg font-semibold text-red-600"},"Confirmation de suppression")],-1)),e("p",st,[d[0]||(d[0]=l(" Êtes-vous sûr de vouloir supprimer la facture ")),e("strong",ot,"#"+m(s.invoice.id),1),d[1]||(d[1]=l(" ? "))]),d[4]||(d[4]=e("p",{class:"text-sm text-gray-500 mt-2"},[l("Cette action est "),e("span",{class:"font-semibold text-red-500"},"irréversible"),l(".")],-1)),e("div",{class:"flex justify-end mt-6 space-x-3"},[e("button",{onClick:u,class:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 transition"}," Annuler "),e("button",{onClick:y,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center"},d[2]||(d[2]=[e("span",{class:"mr-2"},"🗑️",-1),l(" Supprimer ")]))])])])):x("",!0)}},it=V(nt,[["__scopeId","data-v-4a54b780"]]),lt={class:"bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col space-y-4"},at={class:"flex justify-between items-center border-b pb-3"},rt={class:"text-xl font-semibold text-white flex items-center gap-2"},dt={class:"bg-gray-900 p-4 rounded-md space-y-2"},ut={class:"text-gray-300 text-sm"},mt={class:"text-indigo-400 font-bold"},vt={class:"text-gray-300 text-sm"},ct={class:"bg-gray-900 p-4 rounded-md space-y-2"},xt={class:"text-gray-300 text-sm"},ft={class:"text-gray-300 text-sm"},pt={class:"bg-gray-900 p-4 rounded-md grid grid-cols-2 gap-4"},gt={class:"text-gray-300 text-sm"},yt={class:"text-gray-300 text-sm"},bt={class:"text-gray-300 text-sm"},wt={class:"text-gray-300 text-sm"},kt={class:"flex flex-wrap justify-center gap-3 mt-4"},$t=["disabled"],Ct={key:0,class:"animate-spin border-4 border-white border-t-transparent rounded-full w-4 h-4"},It={__name:"InvoiceListItem",props:{invoice:Object},setup(s){const v=S(),{invoicePaid:c}=v,{loading:f}=k(v),r=I(!1),g=I(!1),p=I(!1),u=I(!1);function y(d){return{pending:"bg-yellow-500 text-white px-3 py-1 rounded-full text-xs",issued:"bg-blue-500 text-white px-3 py-1 rounded-full text-xs",paid:"bg-green-500 text-white px-3 py-1 rounded-full text-xs"}[d]||"bg-gray-500 text-white px-3 py-1 rounded-full text-xs"}async function b(d){await c(d)}return(d,t)=>(i(),a($,null,[e("div",lt,[e("div",at,[e("h2",rt," 💰 Facture #"+m(s.invoice.id),1),e("span",{class:P(y(s.invoice.status))},m(s.invoice.status_text),3)]),e("div",dt,[e("p",ut,[t[9]||(t[9]=l(" 👤 ")),t[10]||(t[10]=e("span",{class:"font-semibold text-white"},"Locataire :",-1)),e("span",mt,m(s.invoice.reservation.renter.first_name)+" "+m(s.invoice.reservation.renter.last_name),1)]),e("p",vt,[t[11]||(t[11]=l(" 🏨 ")),t[12]||(t[12]=e("span",{class:"font-semibold text-white"},"Chambre :",-1)),l(" "+m(s.invoice.reservation.room.name),1)])]),e("div",ct,[e("p",xt,[t[13]||(t[13]=l(" 📌 ")),t[14]||(t[14]=e("span",{class:"font-semibold text-white"},"Sujet :",-1)),l(" "+m(s.invoice.subject||"Non renseigné"),1)]),e("p",ft,[t[15]||(t[15]=l(" 💰 ")),t[16]||(t[16]=e("span",{class:"font-semibold text-white"},"Montant :",-1)),l(" "+m(s.invoice.reservation.room.rent)+" € ",1)])]),e("div",pt,[e("p",gt,[t[17]||(t[17]=l(" 🕒 ")),t[18]||(t[18]=e("span",{class:"font-semibold text-white"},"Créée le :",-1)),l(" "+m(s.invoice.created_at),1)]),e("p",yt,[t[19]||(t[19]=l(" 🔄 ")),t[20]||(t[20]=e("span",{class:"font-semibold text-white"},"Mise à jour le :",-1)),l(" "+m(s.invoice.updated_at),1)]),e("p",bt,[t[21]||(t[21]=l(" 💰 ")),t[22]||(t[22]=e("span",{class:"font-semibold text-white"},"Payée le :",-1)),l(" "+m(s.invoice.paid_at||"Non payée"),1)]),e("p",wt,[t[23]||(t[23]=l(" 📩 ")),t[24]||(t[24]=e("span",{class:"font-semibold text-white"},"Émise le :",-1)),l(" "+m(s.invoice.issued_at||"Non envoyé"),1)])]),e("div",kt,[e("button",{onClick:t[0]||(t[0]=o=>u.value=!0),class:"btn-action bg-gray-600"}," 📄 Voir "),s.invoice.status==="pending"?(i(),a("button",{key:0,onClick:t[1]||(t[1]=o=>g.value=!0),class:"btn-action bg-blue-500"}," ✏️ Modifier ")):x("",!0),s.invoice.status==="pending"?(i(),a("button",{key:1,onClick:t[2]||(t[2]=o=>r.value=!0),class:"btn-action bg-red-500"}," 🗑️ Supprimer ")):x("",!0),s.invoice.status==="pending"?(i(),a("button",{key:2,onClick:t[3]||(t[3]=o=>p.value=!0),class:"btn-action bg-yellow-500"}," 📩 Envoyer ")):x("",!0),s.invoice.status==="issued"?(i(),a("button",{key:3,onClick:t[4]||(t[4]=o=>b(s.invoice)),disabled:n(f).paid,class:"btn-action bg-green-500 disabled:opacity-50"},[n(f).paid?(i(),a("span",Ct)):x("",!0),t[25]||(t[25]=l(" ✅ Payé "))],8,$t)):x("",!0)])]),u.value?(i(),w(n(z),{key:0,invoice:s.invoice,onClose:t[5]||(t[5]=o=>u.value=!1)},null,8,["invoice"])):x("",!0),g.value?(i(),w(n(E),{key:1,invoice:s.invoice,onClose:t[6]||(t[6]=o=>g.value=!1)},null,8,["invoice"])):x("",!0),r.value?(i(),w(n(it),{key:2,invoice:s.invoice,onClose:t[7]||(t[7]=o=>r.value=!1)},null,8,["invoice"])):x("",!0),p.value?(i(),w(n(O),{key:3,invoice:s.invoice,onClose:t[8]||(t[8]=o=>p.value=!1)},null,8,["invoice"])):x("",!0)],64))}},St=V(It,[["__scopeId","data-v-651f06f8"]]),Mt={class:"bg-gray-900"},jt={class:"mx-auto max-w-7xl"},Ft={class:"bg-gray-900 py-10"},Vt={class:"px-4 sm:px-6 lg:px-8"},Et={__name:"Invoices",setup(s){return(v,c)=>(i(),a($,null,[F(R),e("div",Mt,[e("div",jt,[e("div",Ft,[e("div",Vt,[c[0]||(c[0]=e("div",{class:"sm:flex sm:items-center"},[e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-base font-semibold leading-6 text-white"},"Factures"),e("p",{class:"mt-2 text-sm text-gray-300"}," Liste de toutes les factures, y compris le sujet, les dates, le statut, et les actions. ")])],-1)),F(n(_))])])])])],64))}};export{Et as default};
