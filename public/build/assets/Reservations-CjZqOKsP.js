import{A as ae,r as S,B as ie,b as le,k as se,C as B,s as j,l as P,o as n,c as l,h as H,u as t,a as e,t as c,F,d as O,g as I,z as de,w as J,f as k,i as M,m as L,n as T,e as h,v as K}from"./app-MOnSz09z.js";import{n as N,b as te,_ as ue}from"./utils-mT5RtY73.js";import{u as oe}from"./renters-BWrsbS6i.js";import{u as re}from"./rooms-BBmIhNCl.js";import{_ as ce}from"./InvoiceFormModal-Ceh5VDJt.js";import"./InvoiceSendMailModal.vue_vue_type_style_index_0_scoped_b9107dd6_lang-CoR13ITW.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./hotel-logo-EkMEN4AC.js";const Y=ae("reservations",()=>{const i=S([]),f=S({}),p=S({}),m=ie("reservation-filters",{renter:"",room:"",month_year:""});function v(r){m.value=r}const y=le(()=>Object.values(m.value).some(r=>r!=="")),_=S([]);se([i,m],()=>{_.value=i.value.filter(r=>{const{renter:g,room:d,month_year:R,status:C}=m.value;if(g&&r.renter.id!==parseInt(g)||d&&r.room.id!==parseInt(d))return!1;if(R){const w=new Date(R),a=w.getMonth(),D=w.getFullYear(),A=new Date(r.start_date),U=r.end_date?new Date(r.end_date):null,z=A.getMonth(),V=A.getFullYear();if(!((V<D||V===D&&z<=a)&&(!U||U>=w)))return!1}return!(C==="ongoing"&&r.end_date||C==="completed"&&!r.end_date)})},{deep:!0,immediate:!0});function $(r){r?f.value[r]=null:f.value={}}function o(r,g){p.value[r]=g}async function x({operation:r,request:g,onSuccess:d}){var R,C,w;$(r),o(r,!0);try{const a=await g();return d&&d(a),a}catch(a){((R=a.response)==null?void 0:R.status)===422?f.value.validationErrors=a.response.data.errors:(f.value[r]=((w=(C=a.response)==null?void 0:C.data)==null?void 0:w.message)||"Une erreur est survenue.",N("error",f.value[r]))}finally{o(r,!1)}}async function E(){return x({operation:"fetch",request:()=>B.get("/api/reservations"),onSuccess:r=>{i.value=r.data.data}})}async function u(r){return x({operation:"add",request:()=>B.post("/api/reservations",r),onSuccess:g=>{i.value.push(g.data.data),N("success",g.data.message)}})}async function s(r){return x({operation:"update",request:()=>B.put(`/api/reservations/${r.id}`,r),onSuccess:g=>{const d=i.value.findIndex(R=>R.id===r.id);d!==-1&&(i.value[d]=g.data.data),N("success",g.data.message)}})}async function q(r){return x({operation:"delete",request:()=>B.delete(`/api/reservations/${r}`),onSuccess:g=>{i.value=i.value.filter(d=>d.id!==r),N("success",g.data.message)}})}return{reservations:i,errors:f,loading:p,fetchReservations:E,addReservation:u,updateReservation:s,deleteReservation:q,clearErrors:$,activeFilters:m,updateFilters:v,filteredReservations:_,isAnyFilterActive:y}}),ve={class:"mt-6"},fe={key:0,class:"flex justify-center my-6"},pe={key:1,class:"flex justify-center my-6"},xe={class:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3"},ge={class:"text-lg font-medium"},be={key:2,class:"flex justify-center my-6"},ye={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8"},_e={__name:"ReservationsList",setup(i){const f=Y(),{fetchReservations:p,clearErrors:m}=f,{filteredReservations:v,errors:y,loading:_}=j(f);return P(()=>{p(),m("fetch")}),($,o)=>(n(),l("div",ve,[H(t(Je)),t(_).fetch?(n(),l("div",fe,o[0]||(o[0]=[e("div",{class:"flex items-center space-x-2 bg-gray-800 px-6 py-3 rounded-lg shadow-lg animate-pulse"},[e("span",{class:"animate-spin inline-block w-6 h-6 border-4 border-white border-t-transparent rounded-full"}),e("p",{class:"text-white text-lg font-medium"},"Chargement des rÃ©servations...")],-1)]))):t(y).fetch?(n(),l("div",pe,[e("div",xe,[o[1]||(o[1]=e("span",{class:"text-xl"},"âŒ",-1)),e("p",ge,"Une erreur est survenue : "+c(t(y).fetch),1)])])):t(v).length===0?(n(),l("div",be,o[2]||(o[2]=[e("div",{class:"bg-gray-800 px-6 py-4 rounded-lg shadow-lg text-center"},[e("p",{class:"text-gray-300 text-lg"},"ðŸ“­ Aucune rÃ©servation trouvÃ©e."),e("p",{class:"text-gray-400 text-sm mt-2"},"Ajoutez-en une pour commencer !")],-1)]))):(n(),l("div",ye,[(n(!0),l(F,null,O(t(v),x=>(n(),I(t(vt),{reservation:x,key:x.id},null,8,["reservation"]))),128))]))]))}},he={class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-md z-50"},ke={class:"bg-white p-6 rounded-xl shadow-xl w-[90%] sm:w-96 transform transition-all animate-fade-in"},we={class:"flex items-center justify-between border-b pb-2"},$e={class:"text-xl font-semibold text-gray-800 flex items-center"},Ce={key:0,class:"mr-2"},Ee={key:1,class:"mr-2"},Re=["value"],Se={key:0,class:"error-message"},Me=["value"],je={key:0,class:"error-message"},Fe={key:0,class:"error-message"},De={key:0,class:"error-message"},Ae={key:0,class:"error-message"},Ue={key:1,class:"error-message"},Ve={key:2,class:"error-message"},Te={class:"flex justify-end space-x-3 mt-4"},Ie=["disabled"],Le={key:0,class:"animate-spin mr-2"},ne={__name:"ReservationFormModal",props:{reservation:Object},emits:["close"],setup(i,{emit:f}){const p=i,m=f,v=Y(),{addReservation:y,updateReservation:_,clearErrors:$}=v,{errors:o,loading:x}=j(v),E=oe(),{renters:u}=j(E),{fetchRenters:s}=E,q=re(),{rooms:r}=j(q),{fetchRooms:g}=q,d=S({id:null,renter_id:"",room_id:"",start_date:"",end_date:""});P(()=>{s(),g()}),de(()=>{var w,a;d.value=p.reservation?{id:p.reservation.id,renter_id:((w=p.reservation.renter)==null?void 0:w.id)||"",room_id:((a=p.reservation.room)==null?void 0:a.id)||"",start_date:te(p.reservation.start_date)||"",end_date:te(p.reservation.end_date)||""}:{id:null,renter_id:"",room_id:"",start_date:"",end_date:""}});const R=async()=>{(d.value.id?await _(d.value):await y(d.value))&&C()},C=()=>{$("validationErrors"),m("close")};return(w,a)=>{var D,A,U,z,V,G,Q,W,X,Z,ee;return n(),l("div",he,[e("div",{onClick:J(C,["self"]),class:"fixed inset-0"}),e("div",ke,[e("div",we,[e("h2",$e,[d.value.id?(n(),l("span",Ce,"âœï¸")):(n(),l("span",Ee,"âž•")),k(" "+c(d.value.id?"Ã‰diter la rÃ©servation":"Ajouter une rÃ©servation"),1)]),e("button",{onClick:C,class:"text-gray-500 hover:text-gray-700 transition"},"âœ–ï¸")]),e("form",{onSubmit:J(R,["prevent"]),class:"mt-4 space-y-4"},[e("div",null,[a[5]||(a[5]=e("label",{for:"renter_id",class:"block text-sm font-medium text-gray-700"},"Locataire",-1)),M(e("select",{"onUpdate:modelValue":a[0]||(a[0]=b=>d.value.renter_id=b),class:T(["input-field",{"border-red-500":(D=t(o).validationErrors)==null?void 0:D.renter_id}])},[a[4]||(a[4]=e("option",{value:""},"SÃ©lectionner un locataire",-1)),(n(!0),l(F,null,O(t(u),b=>(n(),l("option",{value:b.id,key:b.id},c(b.last_name.toUpperCase())+" "+c(b.first_name),9,Re))),128))],2),[[L,d.value.renter_id]]),(A=t(o).validationErrors)!=null&&A.renter_id?(n(),l("p",Se,c(t(o).validationErrors.renter_id.join(" ")),1)):h("",!0)]),e("div",null,[a[7]||(a[7]=e("label",{for:"room_id",class:"block text-sm font-medium text-gray-700"},"Chambre",-1)),M(e("select",{"onUpdate:modelValue":a[1]||(a[1]=b=>d.value.room_id=b),class:T(["input-field",{"border-red-500":(U=t(o).validationErrors)==null?void 0:U.room_id}])},[a[6]||(a[6]=e("option",{value:""},"SÃ©lectionner une chambre",-1)),(n(!0),l(F,null,O(t(r),b=>(n(),l("option",{value:b.id,key:b.id},c(b.name),9,Me))),128))],2),[[L,d.value.room_id]]),(z=t(o).validationErrors)!=null&&z.room_id?(n(),l("p",je,c(t(o).validationErrors.room_id.join(" ")),1)):h("",!0)]),e("div",null,[a[8]||(a[8]=e("label",{for:"start_date",class:"block text-sm font-medium text-gray-700"},"Date de dÃ©but",-1)),M(e("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=b=>d.value.start_date=b),class:T(["input-field",{"border-red-500":(V=t(o).validationErrors)==null?void 0:V.start_date}])},null,2),[[K,d.value.start_date]]),(G=t(o).validationErrors)!=null&&G.start_date?(n(),l("p",Fe,c(t(o).validationErrors.start_date.join(" ")),1)):h("",!0)]),e("div",null,[a[9]||(a[9]=e("label",{for:"end_date",class:"block text-sm font-medium text-gray-700"},"Date de fin (optionnelle)",-1)),M(e("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=b=>d.value.end_date=b),class:T(["input-field",{"border-red-500":(Q=t(o).validationErrors)==null?void 0:Q.end_date}])},null,2),[[K,d.value.end_date]]),(W=t(o).validationErrors)!=null&&W.end_date?(n(),l("p",De,c(t(o).validationErrors.end_date.join(" ")),1)):h("",!0)]),(X=t(o).validationErrors)!=null&&X.date_conflict?(n(),l("p",Ae,c(t(o).validationErrors.date_conflict[0]),1)):h("",!0),(Z=t(o).validationErrors)!=null&&Z.renter_conflict?(n(),l("p",Ue,c(t(o).validationErrors.renter_conflict[0]),1)):h("",!0),(ee=t(o).validationErrors)!=null&&ee.room_conflict?(n(),l("p",Ve,c(t(o).validationErrors.room_conflict[0]),1)):h("",!0),e("div",Te,[e("button",{type:"button",onClick:C,class:"btn-secondary"},"Annuler"),e("button",{type:"submit",class:"btn-primary flex items-center",disabled:d.value.id?t(x).update:t(x).add},[(d.value.id?t(x).update:t(x).add)?(n(),l("span",Le,"â³")):h("",!0),k(" "+c(d.value.id?"Mettre Ã  jour":"Ajouter"),1)],8,Ie)])],32)])])}}},Oe={class:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50"},qe={class:"bg-white p-6 rounded-lg shadow-lg w-[24rem] animate-fade-in transform transition-transform scale-95"},ze={class:"text-gray-700 mt-3"},Be={class:"text-gray-900"},Ne={__name:"ReservationDeleteModal",props:{reservation:Object},emits:["close"],setup(i,{emit:f}){const p=Y(),{deleteReservation:m}=p,v=f;function y(){v("close")}async function _(){await m(i.reservation.id)}return($,o)=>(n(),l("div",Oe,[e("div",{onClick:J(y,["self"]),class:"absolute inset-0"}),e("div",qe,[o[3]||(o[3]=e("div",{class:"flex items-center space-x-3"},[e("span",{class:"text-red-600 text-2xl"},"âš ï¸"),e("h2",{class:"text-lg font-semibold text-red-600"},"Confirmation de suppression")],-1)),e("p",ze,[o[0]||(o[0]=k(" ÃŠtes-vous sÃ»r de vouloir supprimer ")),e("strong",Be,"la rÃ©servation #"+c(i.reservation.id),1),o[1]||(o[1]=k(" ? "))]),o[4]||(o[4]=e("p",{class:"text-sm text-gray-500 mt-2"},[k("Toutes les factures associÃ©es a cette rÃ©servation seront supprimÃ©. Cette action est "),e("span",{class:"font-semibold text-red-500"},"irrÃ©versible"),k(". ")],-1)),e("div",{class:"flex justify-end mt-6 space-x-3"},[e("button",{onClick:y,class:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 transition"}," Annuler "),e("button",{onClick:_,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center"},o[2]||(o[2]=[e("span",{class:"mr-2"},"ðŸ—‘ï¸",-1),k(" Supprimer ")]))])])]))}},Ye={class:"bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col sm:flex-row gap-4"},Ge=["value"],He=["value"],Je={__name:"ReservationFilter",setup(i){const f=Y(),p=oe(),m=re(),{activeFilters:v,isAnyFilterActive:y}=j(f),{updateFilters:_}=f,{renters:$}=j(p),{rooms:o}=j(m);se(v,E=>{_(E)},{deep:!0});const x=()=>{_({renter:"",room:"",status:"",month_year:""})};return P(()=>{p.fetchRenters(),m.fetchRooms()}),(E,u)=>(n(),l("div",Ye,[e("div",null,[u[5]||(u[5]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Locataire :",-1)),M(e("select",{"onUpdate:modelValue":u[0]||(u[0]=s=>t(v).renter=s),class:"filter-input"},[u[4]||(u[4]=e("option",{value:""},"Tous",-1)),(n(!0),l(F,null,O(t($),s=>(n(),l("option",{key:s.id,value:s.id},c(s.last_name.toUpperCase())+" "+c(s.first_name),9,Ge))),128))],512),[[L,t(v).renter]])]),e("div",null,[u[7]||(u[7]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Chambre :",-1)),M(e("select",{"onUpdate:modelValue":u[1]||(u[1]=s=>t(v).room=s),class:"filter-input"},[u[6]||(u[6]=e("option",{value:""},"Toutes",-1)),(n(!0),l(F,null,O(t(o),s=>(n(),l("option",{key:s.id,value:s.id},c(s.name),9,He))),128))],512),[[L,t(v).room]])]),e("div",null,[u[9]||(u[9]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Statut :",-1)),M(e("select",{"onUpdate:modelValue":u[2]||(u[2]=s=>t(v).status=s),class:"filter-input"},u[8]||(u[8]=[e("option",{value:""},"Tous",-1),e("option",{value:"ongoing"},"En cours",-1),e("option",{value:"completed"},"TerminÃ©",-1)]),512),[[L,t(v).status]])]),e("div",null,[u[10]||(u[10]=e("label",{class:"text-sm text-gray-300 font-semibold"},"Mois & AnnÃ©e :",-1)),M(e("input",{type:"month","onUpdate:modelValue":u[3]||(u[3]=s=>t(v).month_year=s),class:"filter-input"},null,512),[[K,t(v).month_year]])]),t(y)?(n(),l("button",{key:0,onClick:x,class:"btn-secondary"}," RÃ©initialiser ")):h("",!0)]))}},Ke={class:"bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col space-y-4 hover:shadow-xl transition-all transform hover:scale-[1.02] border border-gray-700"},Pe={class:"flex justify-between items-center border-b pb-3"},Qe={class:"text-xl font-semibold text-white flex items-center gap-2"},We={class:"bg-gray-900 p-4 rounded-md space-y-3"},Xe={class:"text-gray-300 text-sm flex items-center"},Ze={class:"text-indigo-400 ml-1"},et={class:"text-gray-300 text-sm flex items-center"},tt={class:"text-indigo-400 ml-1"},st={class:"bg-gray-900 p-4 rounded-lg flex flex-col space-y-2"},ot={class:"text-gray-300 text-sm flex items-center"},rt={class:"ml-1 text-indigo-300"},nt={class:"text-gray-300 text-sm flex items-center"},at={class:"ml-1 text-indigo-300"},it={class:"bg-gray-900 p-4 rounded-lg flex flex-col space-y-2"},lt={class:"text-gray-300 text-sm flex items-center"},dt={class:"ml-1 text-indigo-300"},ut={class:"text-gray-300 text-sm flex items-center"},ct={class:"ml-1 text-indigo-300"},mt={__name:"ReservationListItem",props:{reservation:{type:Object,required:!0}},emits:["edit","delete","invoice"],setup(i,{emit:f}){const p=S(!1),m=S(!1),v=S(!1);function y(){p.value=!0}function _(){p.value=!1}function $(){m.value=!0}function o(){m.value=!1}function x(){v.value=!0}function E(){v.value=!1}return(u,s)=>(n(),l(F,null,[e("div",Ke,[e("div",Pe,[e("h2",Qe," ðŸ¨ RÃ©servation #"+c(i.reservation.id),1),e("span",{class:T(["text-xs px-3 py-1 rounded-full font-semibold",i.reservation.end_date?"bg-green-500 text-white":"bg-yellow-500 text-gray-900"])},c(i.reservation.end_date?"TerminÃ©e":"En cours"),3)]),e("div",We,[e("p",Xe,[s[0]||(s[0]=k(" ðŸ‘¤ ")),s[1]||(s[1]=e("span",{class:"ml-2 font-semibold text-white"},"Locataire :",-1)),e("span",Ze,c(i.reservation.renter.last_name.toUpperCase())+" "+c(i.reservation.renter.first_name),1)]),e("p",et,[s[2]||(s[2]=k(" ðŸ“ ")),s[3]||(s[3]=e("span",{class:"ml-2 font-semibold text-white"},"Chambre :",-1)),e("span",tt,c(i.reservation.room.name),1)])]),e("div",st,[e("p",ot,[s[4]||(s[4]=k(" ðŸ“… ")),s[5]||(s[5]=e("span",{class:"ml-2 font-semibold text-white"},"DÃ©but :",-1)),e("span",rt,c(i.reservation.start_date),1)]),e("p",nt,[s[6]||(s[6]=k(" ðŸ“… ")),s[7]||(s[7]=e("span",{class:"ml-2 font-semibold text-white"},"Fin :",-1)),e("span",at,c(i.reservation.end_date||"En cours"),1)])]),e("div",it,[e("p",lt,[s[8]||(s[8]=k(" ðŸ“… ")),s[9]||(s[9]=e("span",{class:"ml-2 font-semibold text-white"},"CrÃ©e le :",-1)),e("span",dt,c(i.reservation.created_at),1)]),e("p",ut,[s[10]||(s[10]=k(" ðŸ“… ")),s[11]||(s[11]=e("span",{class:"ml-2 font-semibold text-white"},"Mise Ã  jour :",-1)),e("span",ct,c(i.reservation.updated_at),1)])]),e("div",{class:"flex justify-center gap-3 mt-4"},[e("button",{onClick:y,class:"btn-action bg-blue-500"}," âœï¸ Modifier "),e("button",{onClick:$,class:"btn-action bg-red-500"}," ðŸ—‘ï¸ Supprimer "),e("button",{onClick:x,class:"btn-action bg-green-500"}," ðŸ§¾ Facture ")])]),p.value?(n(),I(t(ne),{key:0,reservation:i.reservation,onClose:_},null,8,["reservation"])):h("",!0),m.value?(n(),I(t(Ne),{key:1,reservation:i.reservation,onClose:o},null,8,["reservation"])):h("",!0),v.value?(n(),I(t(ce),{key:2,reservation:i.reservation,onClose:E},null,8,["reservation"])):h("",!0)],64))}},vt=me(mt,[["__scopeId","data-v-26b72c44"]]),ft={class:"bg-gray-900"},pt={class:"mx-auto max-w-7xl"},xt={class:"bg-gray-900 py-10"},gt={class:"px-4 sm:px-6 lg:px-8"},bt={class:"sm:flex sm:items-center"},yt={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},St={__name:"Reservations",setup(i){const f=S(!1);return(p,m)=>(n(),l(F,null,[H(ue),e("div",ft,[e("div",pt,[e("div",xt,[e("div",gt,[e("div",bt,[m[2]||(m[2]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-base font-semibold leading-6 text-white"},"RÃ©servations"),e("p",{class:"mt-2 text-sm text-gray-300"}," Liste de toutes les rÃ©servations, y compris les locataires, chambres et dates. ")],-1)),e("div",yt,[e("button",{onClick:m[0]||(m[0]=v=>f.value=!0),type:"button",class:"block rounded-md bg-indigo-500 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-indigo-400"}," Ajouter une rÃ©servation ")])]),H(t(_e)),f.value?(n(),I(t(ne),{key:0,onClose:m[1]||(m[1]=v=>f.value=!1)})):h("",!0)])])])])],64))}};export{St as default};
